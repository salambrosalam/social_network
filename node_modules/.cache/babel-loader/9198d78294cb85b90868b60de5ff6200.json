{"ast":null,"code":"import _regeneratorRuntime from\"E:\\\\react_projects\\\\it-kamasutra\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"E:\\\\react_projects\\\\it-kamasutra\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"E:\\\\react_projects\\\\it-kamasutra\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import{usersAPI}from\"../api/api\";import{stopSubmit}from\"redux-form\";var SET_USER_DATA=\"SET_USER_DATA\";var initialState={userId:null,login:null,email:null,isAuth:false};var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USER_DATA:return _objectSpread(_objectSpread({},state),action.payload);default:return state;}};export var setUserDataActionCreator=function setUserDataActionCreator(userId,login,email,isAuth){return{type:SET_USER_DATA,payload:{userId:userId,login:login,email:email,isAuth:isAuth}};};export var authoriseMeThunkCreator=function authoriseMeThunkCreator(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response,_response$data$data,id,login,email;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return usersAPI.authoriseMe();case 2:response=_context.sent;if(response.data.resultCode===0){_response$data$data=response.data.data,id=_response$data$data.id,login=_response$data$data.login,email=_response$data$data.email;dispatch(setUserDataActionCreator(id,login,email,true));}case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var loginThunkCreator=function loginThunkCreator(email,password,rememberMe){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return usersAPI.login(email,password,rememberMe);case 2:response=_context2.sent;if(response.data.resultCode===0){dispatch(authoriseMeThunkCreator());}else{message=response.data.messages.length>0?response.data.messages[0]:\"Some error\";dispatch(stopSubmit(\"login\",{_error:message}));}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var logoutThunkCreator=function logoutThunkCreator(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return usersAPI.logout();case 2:response=_context3.sent;if(response.data.resultCode===0){dispatch(setUserDataActionCreator(null,null,null,false));}case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export default authReducer;","map":{"version":3,"sources":["E:/react_projects/it-kamasutra/src/redux/authReducer.js"],"names":["usersAPI","stopSubmit","SET_USER_DATA","initialState","userId","login","email","isAuth","authReducer","state","action","type","payload","setUserDataActionCreator","authoriseMeThunkCreator","dispatch","authoriseMe","response","data","resultCode","id","loginThunkCreator","password","rememberMe","message","messages","length","_error","logoutThunkCreator","logout"],"mappings":"gdAAA,OAAQA,QAAR,KAAuB,YAAvB,CACA,OAAQC,UAAR,KAAyB,YAAzB,CAEA,GAAMC,CAAAA,aAAa,CAAG,eAAtB,CAEA,GAAMC,CAAAA,YAAY,CAAG,CACjBC,MAAM,CAAE,IADS,CAEjBC,KAAK,CAAE,IAFU,CAGjBC,KAAK,CAAE,IAHU,CAIjBC,MAAM,CAAE,KAJS,CAArB,CAOA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAkC,IAAjCC,CAAAA,KAAiC,2DAAzBN,YAAyB,IAAXO,CAAAA,MAAW,2CAClD,OAAQA,MAAM,CAACC,IAAf,EACI,IAAKT,CAAAA,aAAL,CACI,sCACOO,KADP,EAEOC,MAAM,CAACE,OAFd,EAIJ,QACI,MAAOH,CAAAA,KAAP,CAPR,CASH,CAVD,CAYA,MAAO,IAAMI,CAAAA,wBAAwB,CAAG,QAA3BA,CAAAA,wBAA2B,CAACT,MAAD,CAASC,KAAT,CAAgBC,KAAhB,CAAuBC,MAAvB,CAAkC,CACtE,MAAO,CACHI,IAAI,CAAET,aADH,CAEHU,OAAO,CAAE,CACLR,MAAM,CAANA,MADK,CACGC,KAAK,CAALA,KADH,CACUC,KAAK,CAALA,KADV,CACiBC,MAAM,CAANA,MADjB,CAFN,CAAP,CAMH,CAPM,CASP,MAAO,IAAMO,CAAAA,uBAAuB,CAAG,QAA1BA,CAAAA,uBAA0B,EAAM,CACzC,+FAAO,iBAAOC,QAAP,wLACkBf,CAAAA,QAAQ,CAACgB,WAAT,EADlB,QACCC,QADD,eAEH,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,qBACPF,QAAQ,CAACC,IAAT,CAAcA,IADP,CAC3BE,EAD2B,qBAC3BA,EAD2B,CACvBf,KADuB,qBACvBA,KADuB,CAChBC,KADgB,qBAChBA,KADgB,CAEhCS,QAAQ,CAACF,wBAAwB,CAACO,EAAD,CAAKf,KAAL,CAAYC,KAAZ,CAAmB,IAAnB,CAAzB,CAAR,CACH,CALE,sDAAP,+DAOH,CARM,CAUP,MAAO,IAAMe,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACf,KAAD,CAAQgB,QAAR,CAAkBC,UAAlB,CAAiC,CAC9D,gGAAO,kBAAOR,QAAP,kKACkBf,CAAAA,QAAQ,CAACK,KAAT,CAAeC,KAAf,CAAsBgB,QAAtB,CAAgCC,UAAhC,CADlB,QACCN,QADD,gBAEH,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,CAChCJ,QAAQ,CAACD,uBAAuB,EAAxB,CAAR,CACH,CAFD,IAEO,CACCU,OADD,CACWP,QAAQ,CAACC,IAAT,CAAcO,QAAd,CAAuBC,MAAvB,CAAgC,CAAhC,CAAoCT,QAAQ,CAACC,IAAT,CAAcO,QAAd,CAAuB,CAAvB,CAApC,CAAgE,YAD3E,CAEHV,QAAQ,CAACd,UAAU,CAAC,OAAD,CAAU,CAAC0B,MAAM,CAAEH,OAAT,CAAV,CAAX,CAAR,CACH,CAPE,wDAAP,iEASH,CAVM,CAYP,MAAO,IAAMI,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,EAAM,CACpC,gGAAO,kBAAOb,QAAP,0JACkBf,CAAAA,QAAQ,CAAC6B,MAAT,EADlB,QACCZ,QADD,gBAEH,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,CAChCJ,QAAQ,CAACF,wBAAwB,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAAmB,KAAnB,CAAzB,CAAR,CACH,CAJE,wDAAP,iEAMH,CAPM,CASP,cAAeL,CAAAA,WAAf","sourcesContent":["import {usersAPI} from \"../api/api\";\r\nimport {stopSubmit} from \"redux-form\";\r\n\r\nconst SET_USER_DATA = \"SET_USER_DATA\";\r\n\r\nconst initialState = {\r\n    userId: null,\r\n    login: null,\r\n    email: null,\r\n    isAuth: false\r\n}\r\n\r\nconst authReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case SET_USER_DATA:\r\n            return {\r\n                ...state,\r\n                ...action.payload,\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport const setUserDataActionCreator = (userId, login, email, isAuth) => {\r\n    return {\r\n        type: SET_USER_DATA,\r\n        payload: {\r\n            userId, login, email, isAuth\r\n        }\r\n    }\r\n}\r\n\r\nexport const authoriseMeThunkCreator = () => {\r\n    return async (dispatch) => {\r\n        let response = await usersAPI.authoriseMe()\r\n        if (response.data.resultCode === 0) {\r\n            let {id, login, email} = response.data.data;\r\n            dispatch(setUserDataActionCreator(id, login, email, true));\r\n        }\r\n    }\r\n}\r\n\r\nexport const loginThunkCreator = (email, password, rememberMe) => {\r\n    return async (dispatch) => {\r\n        let response = await usersAPI.login(email, password, rememberMe);\r\n        if (response.data.resultCode === 0) {\r\n            dispatch(authoriseMeThunkCreator())\r\n        } else {\r\n            let message = response.data.messages.length > 0 ? response.data.messages[0] : \"Some error\";\r\n            dispatch(stopSubmit(\"login\", {_error: message}));\r\n        }\r\n    }\r\n}\r\n\r\nexport const logoutThunkCreator = () => {\r\n    return async (dispatch) => {\r\n        let response = await usersAPI.logout()\r\n        if (response.data.resultCode === 0) {\r\n            dispatch(setUserDataActionCreator(null, null, null, false))\r\n        }\r\n    }\r\n}\r\n\r\nexport default authReducer;"]},"metadata":{},"sourceType":"module"}